{% extends 'base.html' %}
{% load static %}

{% block title %}All Blogs{% endblock %}

{% block pagecontent %}
<!-- ======================= PREMIUM HERO (uses base theme vars) ======================= -->
<section class="ab-hero">
  <div class="ab-hero__bg" aria-hidden="true">
    <span class="blob b1"></span>
    <span class="blob b2"></span>
    <span class="blob b3"></span>
    <span class="grid"></span>
  </div>

  <div class="container ab-hero__inner">
    <h1 class="ab-hero__title">All Blogs</h1>
    <p class="ab-hero__subtitle">Hand-crafted stories, tips, and ideas ‚Äî beautifully presented.</p>

    <!-- elegant chips (replacing search/sort) -->
    <div class="ab-chips">
      <a class="ab-chip active" href="#">üî• Trending</a>
      <a class="ab-chip" href="#">‚ú® Staff Picks</a>
      <a class="ab-chip" href="#">üí° Tutorials</a>
      <a class="ab-chip" href="#">üé® Design</a>
      <a class="ab-chip" href="#">‚öô Tech</a>
    </div>

    {% if request.user.is_authenticated %}
    <div class="ab-hero__cta">
      <a href="{% url 'blog_page' %}" class="ab-btn ab-btn--glass">‚ûï New Post</a>
    </div>
    {% endif %}
  </div>
</section>

<!-- ======================= BLOG GRID ======================= -->
<div class="container ab-wrap">
  <div class="ab-grid">
    {% for blog in blogs %}
    <article class="ab-card">
      <a href="{% url 'blog_detail' blog.id %}" class="ab-card__thumb" aria-label="{{ blog.title|escape }}">
        {% if blog.image %}
        <img src="{{ blog.image.url }}" alt="{{ blog.title|escape }}" loading="lazy">
        {% else %}
        <img src="{% static 'images/default_blog.jpg' %}" alt="Default blog image" loading="lazy">
        {% endif %}
        <span class="ab-card__gloss"></span>
        <span class="ab-card__date">{{ blog.created_at|date:"M j, Y" }}</span>
      </a>

      <div class="ab-card__body">
        <h2 class="ab-card__title">
          <a href="{% url 'blog_detail' blog.id %}">{{ blog.title|truncatechars:90 }}</a>
        </h2>
        <p class="ab-card__excerpt">{{ blog.content|striptags|truncatewords:26 }}</p>
      </div>

      <div class="ab-card__footer">
        <div class="ab-author">
          <span class="ab-author__avatar">
            {% if blog.author.get_full_name %}
            {{ blog.author.get_full_name|slice:":1" }}
            {% else %}
            {{ blog.author.username|slice:":1" }}
            {% endif %}
          </span>
          <div class="ab-author__meta">
            <span class="ab-author__name">
              {% if blog.author.get_full_name %}
              {{ blog.author.get_full_name }}
              {% else %}
              {{ blog.author.username }}
              {% endif %}
            </span>
            <span class="ab-author__muted">{{ blog.created_at|timesince }} ago</span>
          </div>
        </div>

        <a class="ab-btn ab-btn--primary" href="{% url 'blog_detail' blog.id %}">Read ‚Üí</a>
      </div>

      {% if request.user == blog.author or request.user.is_staff %}
      <div class="ab-card__admin">
        <a class="ab-ico" href="{% url 'blog_edit' blog.id %}" title="Edit">‚úè</a>
        <form action="{% url 'blog_delete' blog.id %}" method="post" class="d-inline">
          {% csrf_token %}
          <button type="submit" class="ab-ico danger" title="Delete"
            onclick="return confirm('Delete this blog?');">üóë</button>
        </form>
      </div>
      {% endif %}
    </article>
    {% empty %}
    <div class="ab-empty">
      <div class="ab-empty__emoji">ü™π</div>
      <h3 class="ab-empty__title">No posts yet</h3>
      <p class="ab-empty__desc">When blogs are published, they‚Äôll appear here in a beautiful grid.</p>
      {% if request.user.is_authenticated %}
      <a href="{% url 'create_blog' %}" class="ab-btn ab-btn--primary">Write the first post</a>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  {% if is_paginated %}
  <nav class="ab-pagination" aria-label="Pagination">
    {% if page_obj.has_previous %}
    <a class="ab-page" href="?page={{ page_obj.previous_page_number }}">‚Üê Prev</a>
    {% else %}
    <span class="ab-page disabled">‚Üê Prev</span>
    {% endif %}

    <span class="ab-page current">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
    <a class="ab-page" href="?page={{ page_obj.next_page_number }}">Next ‚Üí</a>
    {% else %}
    <span class="ab-page disabled">Next ‚Üí</span>
    {% endif %}
  </nav>
  {% endif %}
</div>

<!-- ======================= STYLES (inherits base theme; fallbacks included) ======================= -->
<style>
  /* Bridge our page tokens to your base theme tokens (with safe fallbacks) */
  :root {
    --ab-accent-a: var(--accent-a, #ff6ec4);
    --ab-accent-b: var(--accent-b, #7873f5);
    --ab-text: var(--text, #e5e7eb);
    --ab-muted: var(--muted, #9aa4b2);
    --ab-surface: var(--content-bg, rgba(255, 255, 255, 0.06));
    --ab-glass-b: var(--glass-border, rgba(255, 255, 255, .25));
    --ab-radius: var(--card-radius, 22px);
    --ab-shadow: var(--shadow-lg, 0 20px 60px rgba(0, 0, 0, .45));
  }

  /* ---------- HERO (uses base accents, respects dark toggle) ---------- */
  .ab-hero {
    position: relative;
    overflow: hidden;
    padding: 72px 0 28px;
    border-radius: 0 0 36px 36px;
    /* use base gradient if provided */
    background: linear-gradient(135deg, var(--ab-accent-a), var(--ab-accent-b));
  }

  .ab-hero__bg {
    position: absolute;
    inset: 0;
  }

  .ab-hero__bg .grid {
    position: absolute;
    inset: 0;
    opacity: .14;
    background-image: linear-gradient(transparent 31px, rgba(255, 255, 255, .25) 32px),
      linear-gradient(90deg, transparent 31px, rgba(255, 255, 255, .25) 32px);
    background-size: 32px 32px;
  }

  .blob {
    position: absolute;
    filter: blur(30px);
    opacity: .5;
    border-radius: 50%;
  }

  .b1 {
    width: 340px;
    height: 340px;
    background: radial-gradient(circle, var(--ab-accent-a), transparent 70%);
    left: -90px;
    top: -60px;
    animation: drift 18s linear infinite;
  }

  .b2 {
    width: 290px;
    height: 290px;
    background: radial-gradient(circle, var(--ab-accent-b), transparent 70%);
    right: -70px;
    top: 20px;
    animation: drift 22s linear infinite reverse;
  }

  .b3 {
    width: 240px;
    height: 240px;
    background: radial-gradient(circle, var(--ab-accent-a), transparent 70%);
    left: 42%;
    bottom: -120px;
    animation: drift 24s linear infinite;
  }

  @keyframes drift {
    from {
      transform: translateY(0)
    }

    to {
      transform: translateY(20px)
    }
  }

  .ab-hero__inner {
    position: relative;
    z-index: 1;
    text-align: center;
    color: #fff;
  }

  .ab-hero__title {
    font-size: clamp(2.1rem, 5vw, 3.2rem);
    font-weight: 900;
    margin: .4rem 0 .3rem;
  }

  .ab-hero__subtitle {
    opacity: .92;
    font-weight: 500;
    margin-bottom: 1rem
  }

  .ab-chips {
    display: flex;
    flex-wrap: wrap;
    gap: .6rem;
    justify-content: center;
    margin-top: .6rem;
  }

  .ab-chip {
    color: #fff;
    text-decoration: none;
    font-weight: 700;
    border-radius: 999px;
    padding: .5rem 1rem;
    border: 1px solid rgba(255, 255, 255, .35);
    background: rgba(255, 255, 255, .12);
    backdrop-filter: blur(10px);
    transition: .3s;
  }

  .ab-chip:hover {
    transform: translateY(-2px);
    background: rgba(255, 255, 255, .22);
  }

  .ab-chip.active {
    border: none;
    background: linear-gradient(135deg, var(--ab-accent-a), var(--ab-accent-b));
  }

  .ab-hero__cta {
    margin-top: 1rem;
  }

  .ab-btn {
    display: inline-flex;
    align-items: center;
    gap: .5rem;
    text-decoration: none;
    font-weight: 800;
    border-radius: 14px;
    padding: .6rem 1.1rem
  }

  .ab-btn--glass {
    color: #fff;
    border: 1px solid rgba(255, 255, 255, .35);
    background: rgba(255, 255, 255, .12);
    backdrop-filter: blur(10px)
  }

  .ab-btn--glass:hover {
    transform: translateY(-2px) scale(1.01);
  }

  /* ---------- GRID ---------- */
  .ab-wrap {
    margin-top: 28px;
    margin-bottom: 40px;
  }

  .ab-grid {
    display: grid;
    gap: 28px;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }

  .ab-card {
    position: relative;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--ab-surface);
    color: var(--ab-text);
    border-radius: var(--ab-radius);
    box-shadow: var(--ab-shadow);
    transition: .3s;
  }

  .ab-card:hover {
    transform: translateY(-6px);
  }

  .ab-card__thumb {
    position: relative;
    display: block;
    overflow: hidden;
  }

  .ab-card__thumb img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    transition: transform .7s;
  }

  .ab-card:hover .ab-card__thumb img {
    transform: scale(1.06);
  }

  .ab-card__gloss {
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(120deg, transparent 45%, rgba(255, 255, 255, .5), transparent 60%);
    transform: translateX(-120%);
  }

  .ab-card:hover .ab-card__gloss {
    transform: translateX(120%);
    transition: transform .9s;
  }

  .ab-card__date {
    position: absolute;
    bottom: 10px;
    left: 10px;
    padding: 4px 10px;
    font-size: .75rem;
    font-weight: 700;
    border-radius: 999px;
    color: #fff;
    background: rgba(0, 0, 0, .55);
  }

  .ab-card__body {
    padding: 16px 18px 6px;
  }

  .ab-card__title {
    margin: 0 0 8px;
    font-size: 1.15rem;
    font-weight: 900;
    line-height: 1.25;
  }

  .ab-card__title a {
    color: var(--ab-text);
    text-decoration: none;
  }

  .ab-card__title a:hover {
    color: var(--ab-accent-a);
  }

  .ab-card__excerpt {
    color: var(--ab-muted);
  }

  .ab-card__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 18px 18px;
    gap: .8rem;
  }

  .ab-author {
    display: flex;
    align-items: center;
    gap: .6rem;
  }

  .ab-author__avatar {
    width: 38px;
    height: 38px;
    display: grid;
    place-items: center;
    font-weight: 900;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--ab-accent-a), var(--ab-accent-b));
    color: #fff;
  }

  .ab-author__meta {
    display: flex;
    flex-direction: column;
    line-height: 1.05;
  }

  .ab-author__name {
    font-weight: 800;
  }

  .ab-author__muted {
    font-size: .8rem;
    color: var(--ab-muted);
  }

  .ab-btn--primary {
    background: linear-gradient(135deg, var(--ab-accent-a), var(--ab-accent-b));
    color: #fff;
    font-weight: 900;
    padding: .55rem 1.05rem;
    border-radius: 12px;
  }

  .ab-btn--primary:hover {
    transform: translateY(-2px);
    filter: saturate(120%);
  }

  /* Admin quick actions */
  .ab-card__admin {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 6px;
  }

  .ab-ico {
    border: none;
    cursor: pointer;
    border-radius: 10px;
    padding: .35rem .55rem;
    background: rgba(0, 0, 0, .55);
    color: #fff;
    text-decoration: none;
  }

  .ab-ico:hover {
    transform: translateY(-2px);
    background: var(--ab-accent-a);
  }

  .ab-ico.danger:hover {
    background: #ef4444;
  }

  /* Empty state */
  .ab-empty {
    grid-column: 1/-1;
    text-align: center;
    color: var(--ab-text);
    background: var(--ab-surface);
    border-radius: var(--ab-radius);
    padding: 60px 20px;
    box-shadow: var(--ab-shadow);
  }

  .ab-empty__emoji {
    font-size: 3rem;
    margin-bottom: .5rem;
  }

  .ab-empty__title {
    font-weight: 900;
    margin: 0 0 .25rem;
  }

  .ab-empty__desc {
    color: var(--ab-muted);
    margin: 0 0 1rem;
  }

  /* Pagination */
  .ab-pagination {
    display: flex;
    gap: .6rem;
    justify-content: center;
    align-items: center;
    margin-top: 28px;
  }

  .ab-page {
    padding: .5rem .9rem;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 800;
    color: var(--ab-text);
    background: var(--ab-surface);
    border: 1px solid var(--ab-glass-b);
  }

  .ab-page:hover {
    transform: translateY(-2px);
  }

  .ab-page.current {
    background: linear-gradient(135deg, var(--ab-accent-a), var(--ab-accent-b));
    color: #fff;
    border: none;
  }

  .ab-page.disabled {
    opacity: .5;
    pointer-events: none;
  }
</style>

<!-- tiny sheen stagger -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.ab-card').forEach((card, i) => {
      card.style.transitionDelay = (i * 30) + 'ms';
    });
  });
</script>
{% endblock %}